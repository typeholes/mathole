var e=Object.defineProperty,t=(t,a,s)=>(((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s);import{p as a,a as s,d as i,u as n,r,o as l,c as o,b as c,e as d,f as u,t as h,g as m,_ as p,h as g,i as f,s as v,j as y,F as b,n as S,k as N,l as w,w as M,m as k,q as x,v as V,x as _,y as C,K as F,z as A}from"./vendor.be518ff0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),a("data-v-3ea73f38");const T={class:"container"},q={class:"vSplitter"},B={key:0,class:"vLeft"},D={class:"vRight"};s();var j=i({props:{collapsed:{type:Boolean,required:!0,default:!1},leftColSpec:{type:String,required:!1,default:"45%"},rightColSpec:{type:String,required:!1,default:"2fr"}},emits:["update:collapsed"],setup(e,{emit:t}){const a=e;n((e=>({"33a94654":m(s).left.width,"366e43da":a.rightColSpec,"23145d08":m(s).color})));const s=r({color:"rgb(255,255,255)",left:{width:a.leftColSpec,collapsed:a.collapsed,label:"«"}});return(e,i)=>(l(),o("div",T,[c("div",q,[a.collapsed?u("",!0):(l(),o("div",B,[d(e.$slots,"left",{},void 0,!0)])),c("div",{onClick:i[0]||(i[0]=e=>{return i="left",a.collapsed?(s[i].width=a.leftColSpec,s[i].label="«"):(s[i].width="0%",s[i].label="»"),void t("update:collapsed",!a.collapsed);var i}),class:"collapseLeft"},h(m(s).left.label),1),c("div",D,[d(e.$slots,"right",{},void 0,!0)])])]))}});j.__scopeId="data-v-3ea73f38",a("data-v-3090d659");const U={class:"container"},I={class:"vSplitter"},R={class:"vTop"},E={class:"vBottom"},O={key:0};s();var P=i({props:{collapsed:{type:Boolean,required:!0,default:!1},topColSpec:{type:String,required:!1,default:"45%"},bottomColSpec:{type:String,required:!1,default:"2fr"}},emits:["update:collapsed"],setup(e,{emit:t}){const a=e;n((e=>({"1843c624":a.topColSpec,"405d8bce":m(s).bottom.width,"697a065e":m(s).color})));const s=r({color:"rgb(255,255,255)",bottom:{width:a.bottomColSpec,collapsed:a.collapsed}});return(i,n)=>{return l(),o("div",U,[c("div",I,[c("div",R,[d(i.$slots,"top",{},void 0,!0)]),c("div",{onClick:n[0]||(n[0]=e=>{return i="bottom",a.collapsed?s[i].width=a.topColSpec:s[i].width="0%",void t("update:collapsed",!a.collapsed);var i}),class:"collapseTop"},h((r=e.collapsed,r?"»":"«")),1),c("div",E,[a.collapsed?u("",!0):(l(),o("div",O,[d(i.$slots,"bottom",{},void 0,!0)]))])])]);var r}}});P.__scopeId="data-v-3090d659";const W=function(e){return e.name&&(e.toTex=()=>"\\class{hover varname-"+e.name+"}{"+e.name+"}"),e};function G(e,t){const a=e.indexOf(t);-1!==a&&e.splice(a,1)}function J(e){return e.filter(((e,t,a)=>a.indexOf(e)===t))}function L(e,t=8){if("number"!=typeof e)return e;return(e>1e3?e.toExponential(2):e.toFixed(2)).toString().replace("+","").padStart(t," ")}function $(e){return!(void 0===e)}function Y(e,t){return Object.prototype.hasOwnProperty.call(t,e)}const H=g();function K(e,t){H.set(e,t)}function z(e,t,a={},s=Number.MAX_SAFE_INTEGER,i=1){if(e.content)return e.content=z(e.content,t,a,s,i+1),e;if(e.op&&$(e.args))return e.args=e.args.map((e=>z(e,t,a,s,i+1))),e;if(e.fn&&$(e.args)){let d=ne.get(e.fn);if(!$(d)||i>s)return e.args=e.args.map((e=>z(e,t,a,s,i))),e;for(var n=f(d.body),r={},l=0;l<d.argNames.length;l++){var o=d.argNames[l],c=e.args[l];r[o]=z(c,t,{...a},s,i+1)}return z(n,t,{...a,...r},s,i+1)}if(e.name){const s=a[e.name],i=t?s||H.get(e.name):s;if(!$(i))try{const t=e.evaluate();return"number"==typeof t?f(t.toString()):e}catch(d){return e}return"object"==typeof i?i:f(i)}return e.value,e}function X(e){return H.evaluate("string"==typeof e?e:e.toString())}function Z(e,t,a,s={}){return function(){let i=f(e),n=t?z(i,a,s):i;return v(n).transform(W).toTex({parenthesis:"keep",implicit:"hide"})}}function Q(e,t,a={}){return function(){return function(e,t,a={}){var s=z(e,!0,a);return y(s,t)}(f(e),t,a).transform(W).toTex({parenthesis:"keep",implicit:"hide"})}}function ee(e,t={}){return J(z(f(e),!1,t).filter((function(e){return e.isSymbolNode&&$(e.name)&&$(H.get(e.name))})).map((e=>{var t;return null!=(t=e.name)?t:""})))}function te(e,t="",a="",s="",i,n={}){var r;$(t)&&""!==t&&function(e,t,a="",s={}){!function(e){const t=e.map((e=>{var t=document.getElementById(e.id),a=e.toTex();return MathJax.tex2chtmlPromise(a,{em:64,ex:16,display:!1,scale:2}).then((e=>{t&&(t.innerHTML="",t.appendChild(e))}))}));MathJax.typesetClear(),Promise.all(t).then(MathJax.typesetPromise()).then(createHovers)}([{id:a+"pretty",toTex:Z(e,!1,!1)},{id:a+"pretty-val",toTex:Z(e,!0,!1,s)},{id:a+"derivative",toTex:Q(e,t)},{id:a+"derivative-val",toTex:Q(e,t,s)}])}(e.body,"x",t,n);const l=e.body,o=z(f(l),!0,n),c=J(o.filter((function(e){return e.isSymbolNode&&$(e.name)&&$(H.get(e.name))})).map((e=>e.name)));if(c.length>1)throw"too many free variables in "+e.name+": "+c.join(", ");const d=null!=(r=c[0])?r:"t";!function(e,t,a){p({target:e,title:a,width:300,yAxis:{domain:[-1,9]},grid:!0,data:[{fn:t,color:"purple",graphType:"polyline"}],tip:{renderer:function(e,t,a){return t.toString()}}})}(a,("x"===d?"":d+"=x;")+o.toString(),(i[d]||d)+" -> "+s)}class ae{constructor(e,a,s){var i;t(this,"name"),t(this,"argNames"),t(this,"body"),t(this,"_fn"),this.name=e,this.argNames=a,this.body=s,this._fn=(i=this.defString(),{result:"Valid",fn:H.evaluate(i)}).fn}evalArgValues(e){return this.argNames.map((t=>X(e[t])))}argValues(e){return this.argNames.map((t=>e[t]))}signatureString(){return this.name+"("+this.argNames.join(",")+")"}defString(){return this.signatureString()+" = "+this.body}run(e){return this._fn(...this.evalArgValues(e))}callStr(e){return this.name+"("+this.argValues(e).join(",")+")"}callStrEvaluatedArgs(e){return this.name+"("+this.evalArgValues(e).join(",")+")"}}const se={1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h",9:"i",0:"j",".":"k","+":"l","-":"m",",":"n",e:"o"},ie=class{constructor(){t(this,"map",{});const e=new ae("id",["x"],"x");this.map.id=e}static add(e){ie._instance.map[e.name]=e}static get(e){return ie._instance.map[e]}static create(e,t,a){const s=new ae(e,t,a);return ie.add(s),s}static adjust(e,t,a){return this.create(t,e.argNames,a(e.body))}static makeUniqueSuffix(){this.uniqCnt++;return this.uniqCnt.toString().split("").map((e=>Y(e,se)?se[e]:"")).join("")+"_"}};let ne=ie;t(ne,"_instance",new ie),t(ne,"uniqCnt",0);const re={};class le{constructor(e,a,s,i){t(this,"name"),t(this,"displayName"),t(this,"fn"),t(this,"args"),this.name=e,this.displayName=a,this.fn=s,this.args=i}get value(){return this.fn.run(this.args)}spend(e){}dependsOn(e){return $(Object.values(this.args).find((t=>"string"==typeof t&&t.split(/[^a-zA-Z]/).includes(e))))}}const oe=class extends le{constructor(){super("t","Time",ne.get("id"),{x:"t"}),t(this,"time",0)}get value(){return this.time}};let ce=oe;t(ce,"instance",new oe);class de extends le{}class ue extends le{constructor(e,a,s,i,n,r,l=s,o=i,c=!0){super(e,a,s,i),t(this,"_cntBought",0),t(this,"_totalBought",0),t(this,"currency"),t(this,"buyable",!0),t(this,"sellable",!1),t(this,"sellFn"),t(this,"sellArgs"),this.currency=n,this.sellable=r,this.buyable=c,this.sellFn=l,this.sellArgs=o}forceSetCounts(e,t){this._cntBought=e,this._totalBought=t}get cost(){return super.value}get sellCost(){return this.sellFn.run(this.sellArgs)}get value(){return this._cntBought}get totalBought(){return this._totalBought}buy(){return this._cntBought++,this._totalBought++,{gameAction:re,state:!1}}spend(e){this._cntBought-=e}}class he extends ue{constructor(e,t){const a=ne.get("id"),s={x:e};super(e,t,a,s,"",!1,a,s,!1)}}class me extends ue{constructor(e,a,s,i){const n=ne.get("id"),r={x:"0"};super(e,a,n,r,"",!1,n,r,!1),t(this,"reversible"),t(this,"gameAction"),this.reversible=s,this.gameAction=i}buy(){return 0==this._cntBought?(this._cntBought=1,this._totalBought=1,{gameAction:this.gameAction,state:!0}):this.reversible?(this._cntBought=0,{gameAction:this.gameAction,state:!1}):{gameAction:re,state:!1}}}class pe{constructor(){t(this,"buffer",[{actions:[],delay:0}]),t(this,"priorityActions",[]),t(this,"delay",0)}tick(){const e=this.priorityActions;if(this.priorityActions=[],e.forEach((e=>e())),this.delay>0)return void this.delay--;if(this.buffer.length<1)return;const{actions:t,delay:a}=this.buffer.shift()||{actions:[],delay:0};this.delay=a,t.forEach((e=>e()))}asap(...e){this.priorityActions.push(...e)}schedule(e,t=0,a=0){const s=Array.isArray(e)?e:[e];this.buffer.length<1&&this.buffer.push({actions:[],delay:0});const i=this.buffer[this.buffer.length-1];i.delay<1&&a<1?(i.actions.push(...s),i.delay=t):(i.delay<a&&(i.delay=a),this.buffer.push({actions:s,delay:t}))}}const ge={value:0,cost:0,sellCost:0,total:0},fe={reached:!1};class ve{constructor(e,a,s){t(this,"uiStateWriter"),t(this,"milestoneManager"),t(this,"_items",{t:ce.instance}),t(this,"_order",[]),t(this,"_dependencies",{}),t(this,"_deepDependencies",{}),t(this,"_dirty",[]),t(this,"_tickBuffer",new pe),this.uiStateWriter=e,this.milestoneManager=s,this.add(ce.instance,a)}getUiVarField(e,t){const a="string"==typeof e?this.get(e):e;return"value"===t?a.value:"total"===t&&a instanceof ue?a.totalBought:"cost"===t&&a instanceof ue?a.cost:"sellCost"===t&&a instanceof ue?a.sellCost:NaN}setRequiredVarField(e,t,a=NaN){const s="string"==typeof e?this.get(e):e;"dirty"===a&&this._dirty.push(s.name);let i=a;("dirty"==i||isNaN(i))&&(i=this.getUiVarField(s,t)),this.uiStateWriter.setVarField(s.name,t,i),"value"!==t&&"total"!==t||(K(s.name+("total"===t?"_total":""),i),this.handleMilestoneUpdate(s.name))}setUiVarFields(e,t="clean"){const a="string"==typeof e?this.get(e):e;"dirty"===t&&this._dirty.push(a.name),this.setRequiredVarField(a,"cost"),this.setRequiredVarField(a,"sellCost"),this.setRequiredVarField(a,"value"),this.setRequiredVarField(a,"total")}newCalculation(e){const t=new de(e.name,e.displayName,e.fn,e.args);return this.add(t,e.extra),t}newPlain(e){const t=new he(e.name,e.displayName);return this.add(t,e.extra),t.spend(-1*e.value),t}newToggle(e){const t=new me(e.name,e.displayName,e.reversible,e.gameAction||re);return this.add(t,e.extra),t}newBuyable(e){const t=new ue(e.name,e.displayName,e.fn,e.args,e.currency,e.sellable);this.add(t,e.extra),this.setRequiredVarField(t,"value"),this.setRequiredVarField(t,"cost");const a=this._items[e.currency];return a instanceof de&&(a.fn=ne.adjust(a.fn,name+"_"+e.currency,(t=>t+" - "+e.fn.callStr(e.args).replace(e.name,e.name+"_total")+" + "+e.fn.callStrEvaluatedArgs(e.args)))),this.setRequiredVarField(a,"value","dirty"),t}add(e,t){this.uiStateWriter.addVar(e.name,t),this._dependencies[e.name]=[],this._calculateDependencies(e),this._deepDependencies[e.name]=function(e,t={}){return e?ee(e.body,t):[]}(e.fn,e.args),this._order.push(e.name),this._items[e.name]=e,this.setRequiredVarField(e,"value","dirty")}_calculateDependencies(e){for(const t in this._items)e.dependsOn(t)&&this._dependencies[t].push(e.name)}get(e){return this._items[e]}getNames(){return[...this._order]}asap(...e){this._tickBuffer.asap(...e)}schedule(e,t=0,a=0){this._tickBuffer.schedule(e,t,a)}tick(e){const t=this._items.t;t.time+=e,this.setRequiredVarField(t,"value",t.time),this._dirty.push("t");for(let a=0;a<2;a++){const e=[];this._order.forEach((t=>{if(this._dirty.includes(t)){const a=this._items[t];this.setUiVarFields(a),this._dirty.push(...this._dependencies[t]),e.push(t)}this._dirty=J(this._dirty),e.forEach((e=>{G(this._dirty,e)}))}))}this._tickBuffer.tick()}isBuyable(e){const t=this.get(e);return t instanceof ue&&t.buyable}isToggle(e){return this.get(e)instanceof me}isSellable(e){const t=this.get(e);return t instanceof ue&&t.sellable}getDependencies(e){const t=this._deepDependencies[e]||[],a=t.map((e=>this.getDependencies(e))).flat();return t.push(...a),t}getDependents(e){const t=[];return this._order.forEach((a=>{this._deepDependencies[a].includes(e)&&t.push(a)})),t}getCurrency(e){const t=this.get(e);if(!(t instanceof ue))throw e+" does not have a currency";return this.get(t.currency)}getCurrencyName(e){const t=this.getCurrency(e);return t?t.name:""}sell(e){const t=this.get(e);if(!(t instanceof ue))return;const a=this.getCurrencyName(e),s=this.get(a),i=t.cost;t.spend(1),this.setUiVarFields(t,"dirty"),s.spend(-1*i),this.setUiVarFields(s,"dirty")}buy(e){const t=this.get(e);if(!(t instanceof ue))return;const a=this.getCurrencyName(e),s=this.get(a),i=t.cost;if(i>this.getUiVarField(s,"cost"))return;const{gameAction:n,state:r}=t.buy();this.setUiVarFields(t,"dirty"),s&&(s.spend(i),this.setUiVarFields(s,"dirty")),this.handleAction(n,r)}setFromUIValues(){this._order.forEach((e=>{const t=this._items[e];t instanceof ue?t.forceSetCounts(this.uiStateWriter.getVarField(e,"value"),this.uiStateWriter.getVarField(e,"total")):t instanceof ce&&(t.time=this.uiStateWriter.getVarField(e,"value")),this._dirty.push(e),K(e,this.uiStateWriter.getVarField(e,"value")),K(e+"_total",this.uiStateWriter.getVarField(e,"value")),this.handleMilestoneUpdate(e)}))}handleMilestoneUpdate(e){this.milestoneManager.handleUpdate(e).forEach((e=>this.handleAction(e)))}handleAction(e,t=!0){if(e.setUiFields)for(let a in e.setUiFields)this.uiStateWriter.setVarFields(a,e.setUiFields[a]);if(e.setBuyable)for(let a in e.setBuyable){const e=this.get(a);e instanceof ue&&(e.buyable=t)}if(e.setSellable)for(let a in e.setSellable){const e=this.get(a);e instanceof ue&&(e.sellable=t)}if(e.adjustFunctions){if(!t)throw"Undoing adjustFunction GameActions not implemented";for(let t in e.adjustFunctions)for(const a in e.adjustFunctions[t]){const s=e.adjustFunctions[t][a];this.adjustFnOf(t,a,s,"M")}}}adjustFnOf(e,t,a,s){const i=this.get(e),n="_"+s+ne.makeUniqueSuffix();let r,l;if("value"!==t||i instanceof ue)if("cost"===t&&i instanceof ue)r=i.fn,l=e=>i.fn=e;else{if(!("sellCost"===t&&i instanceof ue))throw"invalid fnType "+t+" for "+i.name;r=i.sellFn,l=e=>i.sellFn=e}else r=i.fn,l=e=>i.fn=e;l(ne.adjust(r,r.name+n,(e=>a.replace("<&>",r.signatureString()))))}getDisplayExpr(e){const t=this._order.map((e=>[e,this.get(e).displayName]));return function(e,t){return f(e).transform((function(e,a,s){return e.isSymbolNode&&$(e.name)&&t[e.name]?f('"'+t[e.name]+'"'):e})).toString()}(e,Object.fromEntries(t))}}class ye{constructor(e){t(this,"saves",{}),t(this,"uiStateGetter"),this.uiStateGetter=e;const a=window.localStorage.getItem("matholeSaves");a?this.parseSaveStr(a):this.save("default")}save(e){this.buildNewSave(e),this.writeSaves()}load(e){return this.saves[e]}readSave(e){return!1}parseSaveStr(e){this.saves=JSON.parse(e)}writeSaves(){const e=JSON.stringify(this.saves);window.localStorage.setItem("matholeSaves",e)}buildNewSave(e){this.saves[e]=this.uiStateGetter()}}class be{constructor(e,a,s,i,n="",r={}){t(this,"name"),t(this,"displayName"),t(this,"rewardtext"),t(this,"condition"),t(this,"rewardAction"),this.name=e,this.displayName=a,this.rewardtext=n,this.condition=s,this.rewardAction=r}check(){return X(this.condition)}}class Se{constructor(e){t(this,"milestoneMap",{}),t(this,"dependencies",{}),t(this,"uiStateWriter"),this.uiStateWriter=e}create(e,t,a,s=!1,i="",n={},r){this.uiStateWriter.addMilestone(e,r);const l=new be(e,t,a,s,i,n);this.milestoneMap[e]=l;return ee(a).forEach((t=>{var a;(a=this.dependencies)[t]||(a[t]=[]),this.dependencies[t].push(e)})),l}handleUpdate(e){const t=this.dependencies[e];if(!t)return[];const a=[];return t.forEach((e=>{if(ke.instance.milestoneReached(e))return;const t=this.milestoneMap[e];if(t.check()){this.uiStateWriter.setReached(e),a.push(t.rewardAction);const s=ke.instance.callbacks.milestoneReached;s&&s.forEach((e=>e(t.name,t.rewardAction.storyPoint||"")))}})),a}getNames(){return Object.keys(this.milestoneMap)}get(e){return this.milestoneMap[e]}}class Ne{constructor(e,a){t(this,"uiState"),t(this,"uiStateMethods"),this.uiState=e,this.uiStateMethods=a}setReached(e){this.uiStateMethods.milestoneSetter(this.uiState,e,!0)}addVar(e,t){this.uiStateMethods.varAdder(this.uiState,e,t)}addMilestone(e,t){this.uiStateMethods.milestoneAdder(this.uiState,e,t)}loadReached(e,t){this.uiStateMethods.milestoneSetter(this.uiState,e,t)}getVarField(e,t){return this.uiStateMethods.varGetter(this.uiState,e,t)}setVarField(e,t,a){this.uiStateMethods.varSetter(this.uiState,e,t,a)}setVarFields(e,t){for(let a in t)this.uiStateMethods.varSetter(this.uiState,e,a,t[a])}}function we(...e){}const Me=class{constructor(e,a,s,i,n){var r;t(this,"canTick",!1),t(this,"callbacks"),t(this,"hasStarted",!1),t(this,"gameVarManager"),t(this,"saveManager"),t(this,"milestoneManager"),t(this,"uiState"),t(this,"uiStateMethods"),t(this,"uiStateWriter"),this.uiState=e,this.uiStateMethods=a,this.callbacks=n;for(const t in n)Y(t,this.callbacks)&&((r=this.callbacks)[t]||(r[t]=[we]));this.uiStateWriter=new Ne(e,a),this.milestoneManager=new Se(this.uiStateWriter),this.gameVarManager=new ve(this.uiStateWriter,s,this.milestoneManager),i(this.gameVarManager,ne,this.milestoneManager),this.saveManager=new ye((()=>this.uiStateMethods.cloner(this.uiState)))}static init(e,t,a,s,i){return Me._instance=new Me(e,t,a,s,i),e}static getInstance(){return Me._instance}start(){this.hasStarted||(this.hasStarted=!0,this.canTick=!0)}asap(...e){this.gameVarManager.asap(...e)}schedule(e,t=0,a=0){this.gameVarManager.schedule(e,t,a)}displayFunction(e,t,a,s){const i=this.gameVarManager.get(e);te(i.fn,"",t,s,a,i.args)}milestoneReached(e){return this.uiStateMethods.milestoneGetter(this.uiState,e)}getNameMap(){const e={};return this.gameVarManager.getNames().forEach((t=>e[t]=this.getDisplayName(t))),e}getNames(e=!1){if(e){return this.gameVarManager.getNames().filter((t=>{const a=this.uiState.vars[t];return e(a)}))}return this.gameVarManager.getNames()}tick(e){this.canTick&&(this.canTick=!1,this.gameVarManager&&this.gameVarManager.tick(e),this.canTick=!0)}getDisplayName(e){return""===e?"WTF!":this.gameVarManager.get(e).displayName}buy(e){this.gameVarManager.buy(e)}sell(e){this.gameVarManager.sell(e)}isSellable(e){return this.gameVarManager.isSellable(e)}isBuyable(e){return this.gameVarManager.isBuyable(e)}isToggle(e){return this.gameVarManager.isToggle(e)}getCurrencyName(e){return this.gameVarManager.getCurrencyName(e)}getCurrencyDisplayName(e){return""===e?"":this.getDisplayName(this.getCurrencyName(e))}getDependencies(e){return this.gameVarManager.getDependencies(e)}getDependents(e){return this.gameVarManager.getDependents(e)}getMilestoneNames(){return this.milestoneManager.getNames()}getMilestoneDisplayName(e){return e?this.milestoneManager.get(e).displayName:""}getMilestoneReward(e){return e?this.milestoneManager.get(e).rewardtext:""}getMilestoneCondition(e){if(!e)return"";const t=this.milestoneManager.get(e).condition;return this.getDisplayExpr(t)}getDisplayExpr(e){return this.gameVarManager.getDisplayExpr(e)}save(){this.canTick=!1,this.saveManager.save("default"),this.canTick=!0}load(){this.canTick=!1;const e=this.saveManager.load("default"),t=e.vars,a=e.milestones;this.gameVarManager.getNames().forEach((e=>{const a=t[e]||{value:0,cost:0,sellCost:0,total:0},s=a.value,i=a.cost,n=a.cost,r=a.total;this.gameVarManager.setRequiredVarField(e,"value",s),this.gameVarManager.setRequiredVarField(e,"cost",i),this.gameVarManager.setRequiredVarField(e,"sellCost",n),this.gameVarManager.setRequiredVarField(e,"total",r)})),this.milestoneManager.getNames().forEach((e=>{this.uiStateWriter.loadReached(e,(a[e]||{reached:!1}).reached)})),this.gameVarManager.setFromUIValues(),this.canTick=!0}static get instance(){return Me._instance}};let ke=Me;t(ke,"_instance");let xe=null;function Ve(){Te("Help",!0,!1)}function _e(){return Object.keys(xe)}function Ce(){return e=qe.sidebarMode,xe[e]||xe.Sidebars;var e}let Fe=["Sidebars"];function Ae(){const e=Fe.pop();Te(e||"Sidebars",!1)}function Te(e,t=!0,a=!0){a&&(qe.helpKey=e),t&&"Sidebars"!==qe.sidebarMode&&Fe.push(qe.sidebarMode),Fe.length>20&&Fe.splice(0,Fe.length-20),qe.sidebarMode=e}const qe=r({graphedVarName:"",selectedVarName:"",dependencies:[],dependents:[],sidebarMode:"Story",helpKey:""}),Be={visible:!0,janky:!1},De=r({vars:{},milestones:{}});const je={cloner:e=>function(e){const t={vars:{},milestones:{}};for(let a in e.vars)t.vars[a]={...e.vars[a]};return t.milestones={...e.milestones},t}(e),varAdder:(e,t,a)=>e.vars[t]=r({...Be,...ge,...a}),varGetter:(e,t,a)=>e.vars[t][a],varSetter:(e,t,a,s)=>e.vars[t][a]=s,milestoneAdder:(e,t,a)=>e.milestones[t]=r({...fe,...fe,...a}),milestoneGetter:(e,t)=>e.milestones[t].reached,milestoneSetter:(e,t,a)=>e.milestones[t].reached=a};function Ue(e){const t=De.vars[e].visible;return s=!0,$(a=t)?a:s;var a,s}function Ie(e){return De.vars[e].value}function Re(e){return De.vars[e].total}function Ee(e){return De.vars[e].sellCost}function Oe(e){return De.vars[e].cost}function Pe(e){return(De.milestones[e]||{}).reached}function We(e){if("Dependencies"===qe.sidebarMode)if(qe.selectedVarName===e)qe.selectedVarName="",qe.dependencies=[],qe.dependents=[];else{qe.selectedVarName=e;let t=$e.getDependencies(e),a=$e.getDependents(e);qe.dependencies=t,qe.dependents=a}"Graph"===qe.sidebarMode&&(qe.graphedVarName=e,Je(!1))}function Ge(e){return($e.isBuyable(e)?"Cost of ":"")+$e.getDisplayName(e)}function Je(e=!0){""!==qe.graphedVarName&&(e?$e.schedule((()=>{$e.displayFunction(qe.graphedVarName,"#test-graph-expr",$e.getNameMap(),Ge(qe.graphedVarName))}),0,1):$e.displayFunction(qe.graphedVarName,"#test-graph-expr",$e.getNameMap(),Ge(qe.graphedVarName)))}const Le={milestoneReached:[function(e,t){$e.schedule((()=>{Te("Story")})),t||$e.schedule((()=>{"Story"===qe.sidebarMode&&Ae()}),0,2)}]};ke.init(De,je,Be,(function(e,t,a){const s=t.get("id"),i=t.create("times",["x","b"],"x*b");t.create("reciprical",["x"],"1/(x+1)"),t.create("zigZag",["x"],"1-2 * acos((1- smoother) * sin(2 * pi * x))/pi"),t.create("squareWave",["x"],"2 * atan( sin(2 * pi * x)/ smoother )/pi"),t.create("sawtooth",["x"],"(1+zigZag((2 * x - 1)/4) * squareWave(x/2))/2"),t.create("steps",["x"],"x - sawtooth(x)"),t.create("logSquares",["x","b"],"log(x^2+b^2)"),t.create("curvedSawtooth",["x"],"logSquares(x^smoother,sawtooth(x))");const n=t.create("calcMarketValue",["x"],"curvedSawtooth(x)*(marketScale+1)");e.newPlain({name:"money",displayName:"$",visible:!1,value:1,extra:{}}),e.newBuyable({name:"stability",displayName:"Market Stability",visible:!0,fn:i,args:{x:1.25,b:"stability+2/1.25"},currency:"money",sellable:!1,extra:{}}),e.newBuyable({name:"marketScale",displayName:"Market Scale",visible:!0,fn:i,args:{x:2,b:"marketScale+1"},currency:"stability",sellable:!1,extra:{}}),e.newCalculation({name:"smoother",displayName:"Smoother",visible:!1,fn:i,args:{x:"stability",b:.01},extra:{}}),e.newCalculation({name:"marketValue",displayName:"Market Value",visible:!0,fn:n,args:{x:"t"},extra:{}}),e.newBuyable({name:"shares",displayName:"Shares",visible:!0,fn:s,args:{x:"marketValue"},currency:"money",sellable:!0,extra:{}}),e.newBuyable({name:"premiumJanky",displayName:"Premium",visible:!0,fn:s,args:{x:"100"},currency:"money",sellable:!1,extra:{janky:!0}}),e.newToggle({name:"reallyFree",displayName:"Yes I'm sure",visible:!0,reversible:!1,extra:{janky:!0},gameAction:{setUiFields:{loggedIn:{visible:!0},reallyFree:{visible:!1}}}}),e.newToggle({name:"freeAccount",displayName:"Switch to a free account now",visible:!0,reversible:!1,extra:{janky:!0}}),e.newToggle({name:"loggedIn",displayName:"Log In",visible:!1,reversible:!1,extra:{janky:!0,visible:!1}}),a.create("startStory","Went Bankrupt","t > 0",!0,"You start the game from scratch",{storyPoint:'You went bankrupt. All you have left is your library card and a dollar\'s worth of coins you found in the gutter. Time to head to the library, grab a computer, and login to jankyMarketTrader.com\n\n Warning: this is just a preview release so there will likely be bugs\n There is no auto save. Use the save and load buttons\n It is possible to price yourself out of the market until you reach the "Too Stable?" milestone\n this is intended to force some strategic play while the cost of having to restart is low'},{}),a.create("tooStable","Too Stable?","stability > 3",!0,"Can sell Market Stability",{setSellable:{stability:!0},storyPoint:"It is harder to make money in stable markets. Maybe you should trade some of that stability to increase the scale of the market."},{}),a.create("scaled","Insider Trading","marketScale >= 1",!0,"Better price when selling shares ",{adjustFunctions:{shares:{sellCost:" 1.1 * <&>"}}},{})}),Le);const $e=ke.instance,Ye={key:0,class:"gamevar"},He={class:"label"},Ke={key:0,class:"value"},ze={class:"buy"},Xe=["disabled"],Ze={class:"sell"},Qe=["disabled"];var et=i({props:{varName:{type:String,required:!0},forceVisible:{type:Boolean,required:!1,default:!1},hideCnt:{type:Boolean,required:!1,default:!1}},setup(e){const t=e,a=ke.getInstance();function s(e){const t=a.getCurrencyName(e);if(!t)return!1;return Ie(t)>=Oe(e)}function i(e){let t={marker:!0,dependent:!1,depends:!1,hidden:!0,inline:!0};return e===qe.selectedVarName?(t.hidden=!1,t):(qe.dependencies.includes(e)&&(t.dependent=!0,t.hidden=!1),qe.dependents.includes(e)&&(t.depends=!0,t.hidden=!1),t)}function n(e){a.buy(e),Je()}return(r,d)=>{return e.forceVisible||m(Ue)(e.varName)?(l(),o("div",Ye,[m(a).isToggle(e.varName)?(l(),o("button",{key:0,onClick:d[0]||(d[0]=t=>n(e.varName))},h(m(a).getDisplayName(e.varName)),1)):(l(),o(b,{key:1},[c("div",{class:S(i(e.varName))},[c("span",null,h(e.varName===m(qe).selectedVarName?"⊜":"⇒"),1)],2),c("div",He,[c("span",{onClick:d[1]||(d[1]=t=>m(We)(e.varName))},h(m(a).getDisplayName(e.varName))+": ",1)]),t.hideCnt?u("",!0):(l(),o("div",Ke,h(m(L)(m(Ie)(e.varName))),1)),c("div",ze,[m(a).isBuyable(e.varName)?(l(),o("button",{key:0,onClick:d[2]||(d[2]=t=>n(e.varName)),disabled:!s(e.varName)}," Buy: "+h(m(L)(m(Oe)(e.varName)))+" "+h(m(a).getCurrencyDisplayName(e.varName)),9,Xe)):u("",!0)]),c("div",Ze,[m(a).isSellable(e.varName)?(l(),o("button",{key:0,onClick:d[3]||(d[3]=t=>{return s=e.varName,a.sell(s),void Je();var s}),disabled:(p=e.varName,!(Ie(p)>0))},"Sell: "+h(m(L)(m(Ee)(e.varName)))+" "+h(m(a).getCurrencyDisplayName(e.varName)),9,Qe)):u("",!0)])],64))])):u("",!0);var p}}});const tt={class:"container"},at={key:0},st={key:1};var it=i({props:{swap:{type:Boolean,required:!0}},setup:e=>(t,a)=>(l(),o("div",tt,[e.swap?(l(),o("div",at,[d(t.$slots,"after")])):(l(),o("div",st,[d(t.$slots,"before")]))]))});a("data-v-4c08ccf0");const nt=c("hr",null,null,-1),rt=c("h5",null,"http://jankymarkettrader.com",-1),lt=c("hr",null,null,-1),ot=c("div",{id:"mqdiv"},[c("div",{id:"mqdiv1"},[N("  Upgrade to a "),c("b",{class:"glow"},"Premuim"),N(" account now!!!!!! ")]),c("div",{id:"mqdiv2"},[N("  Upgrade to a "),c("b",null,"Premuim"),N(" account now!!!!!! ")])],-1),ct=c("div",{class:"blink_me"}," Your account has been disabled due to automatic payments being declined ",-1),dt=c("input",{type:"text"},null,-1),ut=N(" freebee ");s();var ht=i({setup(e){function t(e){return 1===De.vars[e].value}n((e=>({"61f5a551":m(a).y,"61f5a550":m(a).x})));const a=r({x:"0px",y:"0px"}),s=e=>{a.x=e.clientX-100+"0px",a.y=e.clientY-100+"0px"};return(e,i)=>(l(),o("div",{class:"jankyPane",onPointermove:s},[nt,rt,lt,N(" "+h(m(a)),1),ot,w(it,{swap:t("loggedIn")},{before:M((()=>[w(it,{swap:t("freeAccount")},{before:M((()=>[ct,dt,c("button",{onClick:i[0]||(i[0]=e=>{alert("JankyMarketTrader.com says\\nCould not process payment for user: Password123")})}," Update Credit Card "),w(et,{"var-name":"freeAccount"})])),after:M((()=>[(l(),o(b,null,k(["loggedIn","reallyFree"],(e=>c("div",null,[w(et,{"var-name":e},null,8,["var-name"])]))),64))])),_:1},8,["swap"])])),after:M((()=>[ut])),_:1},8,["swap"]),w(et,{"var-name":"premiumJanky","hide-cnt":""})],32))}});ht.__scopeId="data-v-4c08ccf0";const mt={class:"game"},pt={key:0,class:"varPane"},gt={class:"mainVar"},ft={class:"vars"},vt={class:"contents"};var yt=i({setup(e){const t=ke.getInstance(),a=x(!1);return(e,s)=>(l(),o("div",mt,[w(j,{leftColSpec:"45%",rightColSpec:"1fr",collapsed:a.value,"onUpdate:collapsed":s[0]||(s[0]=e=>a.value=e)},{left:M((()=>[w(ht)])),right:M((()=>[m(De).vars.loggedIn.value>0?(l(),o("div",pt,[c("div",gt,[w(et,{varName:"t",forceVisible:""}),w(et,{varName:"money",forceVisible:""})]),c("div",ft,[(l(!0),o(b,null,k(t.getNames((e=>!e.janky)),(e=>(l(),o("div",vt,[w(et,{varName:e},null,8,["varName"])])))),256))])])):u("",!0)])),_:1},8,["collapsed"])]))}});const bt={class:"gamevar"},St=c("br",null,null,-1);var Nt=i({props:{varName:{type:String,required:!0}},setup(e){const t=ke.getInstance();function a(e){const t={...De.vars[e]};return delete t.value,delete t.cost,delete t.total,delete t.sellCost,t}return(s,i)=>(l(),o("tr",bt,[c("td",null,h(e.varName),1),c("td",null,h(m(L)(m(Ie)(e.varName))),1),c("td",null,h(m(L)(m(Re)(e.varName))),1),c("td",null,h(m(L)(m(Oe)(e.varName))),1),c("td",null,h(m(L)(m(Ee)(e.varName))),1),c("td",null,h(m(t).getDisplayName(e.varName)),1),c("td",null,h(a(e.varName)),1),St]))}});const wt={class:"vars"},Mt={style:{display:"table-row-group"}};var kt=i({setup(e){const t=ke.getInstance();return x(!1),(e,a)=>(l(),o("div",null,[c("table",wt,[(l(!0),o(b,null,k([...t.getNames()].sort(),(e=>(l(),o("div",Mt,[w(Nt,{varName:e},null,8,["varName"])])))),256))])]))}}),xt=i({setup(e){const t=ke.getInstance();return(e,a)=>(l(),o("div",null,[c("button",{onClick:a[0]||(a[0]=(...e)=>m(t).save&&m(t).save(...e))},"save"),c("button",{onClick:a[1]||(a[1]=(...e)=>m(t).load&&m(t).load(...e))},"load")]))}});const Vt=c("br",null,null,-1),_t=c("br",null,null,-1);var Ct=i({setup(e){const t=ke.getInstance();return(e,a)=>(l(),o("div",null,[N(" Dependencies: "+h(m(qe).dependencies.map((e=>m(t).getDisplayName(e))).join(", "))+" ",1),Vt,_t,N(" Dependents: "+h(m(qe).dependents.map((e=>m(t).getDisplayName(e))).join(", ")),1)]))}});const Ft={},At=[c("div",{id:"test-graph-expr",class:"graphDiv"},null,-1)];Ft.render=function(e,t){return l(),o("div",null,At)};const Tt=c("br",null,null,-1),qt=c("hr",null,null,-1);var Bt=i({props:{name:{type:String,required:!0}},setup(e){const t=ke.getInstance();return(a,s)=>(l(),o(b,null,[c("div",{class:S({milestone:!0,reached:m(Pe)(e.name)})},[N(h(m(t).getMilestoneDisplayName(e.name))+": "+h(m(t).getMilestoneCondition(e.name)),1),Tt,N(" "+h(m(t).getMilestoneReward(e.name)),1)],2),qt],64))}});const Dt={class:"milestones"},jt={class:"contents"};var Ut=i({setup(e){const t=ke.getInstance();return(e,a)=>(l(),o("div",Dt,[(l(!0),o(b,null,k(m(t).getMilestoneNames(),(e=>(l(),o("div",jt,[w(Bt,{name:e},null,8,["name"])])))),256))]))}});const It={style:{"white-space":"pre-wrap"}};var Rt=i({setup(e){let t=r({milestoneName:"",storyPoint:""});var a;return a=(e,a)=>{t.milestoneName=e,t.storyPoint=a},Le["milestoneReached"].push(a),(e,a)=>(l(),o("div",null,[c("div",null,[w(Bt,{name:m(t).milestoneName},null,8,["name"])]),c("span",It,h(m(t).storyPoint),1)]))}});const Et={class:"contents"},Ot=["onClick"];var Pt=i({setup:e=>(e,t)=>(l(!0),o(b,null,k(m(_e)(),(e=>(l(),o("div",Et,[c("div",null,[c("button",{onClick:t=>m(Te)(e)},h(e),9,Ot)])])))),256))});const Wt={style:{"white-space":"pre-wrap"}};var Gt=i({setup(e){const t={Sidebars:"Click a button in the sidebar to set the sidebar mode",Options:"Just save and load for now.  More planned",Dependencies:'\nClick a label in the main pane to show the relationships between values.  \n<= means "affects the selected value"\n(=) means "is the selected value"\n=> means "affected by the selected value"\n',Graph:"\nClick a label in the main pane to show a graph for the value.\nThe title of the graph will be X -> Y\nTODO describe graph types\n\nBug: graph is not updated after loading.\n",Help:"hover over the ? icon in the top right of the side bar to get help for the current sidebar mode",Story:"Shows the most recently reached milestone and associated story point",Milestones:"\nShows milestones\nPink = unreached\nGreen = reached\n\nTODO interact with eselected value\n"};return(e,a)=>(l(),o("div",null,[c("span",Wt,h(t[m(qe).helpKey]||"TODO"),1)]))}});const Jt={class:"mathole"},Lt={class:"sideTopbar"},$t={class:"sidebar"};var Yt=i({setup(e){xe={Options:xt,Dependencies:Ct,Graph:Ft,Milestones:Ut,Story:Rt,Sidebars:Pt,Help:Gt};let t=0;function a(e){const s=e-t;$e.canTick&&s>=500&&($e.tick(s/1e4),t=e),window.requestAnimationFrame(a)}V((()=>{$e.start(),window.requestAnimationFrame(a)}));const s=x(!1),i=x(!0);return(e,t)=>(l(),o("div",Jt,[w(P,{"top-col-spec":"minmax(contents,1fr)","bottom-col-spec":"50px",collapsed:i.value,"onUpdate:collapsed":t[5]||(t[5]=e=>i.value=e)},{top:M((()=>[w(j,{"left-col-spec":"1fr","right-col-spec":"300px",collapsed:s.value,"onUpdate:collapsed":t[4]||(t[4]=e=>s.value=e)},{left:M((()=>[w(yt)])),right:M((()=>[c("div",Lt,[c("button",{onClick:t[0]||(t[0]=e=>m(Ae)())}," ←"),N(" "+h(m(qe).sidebarMode)+" ",1),c("button",{onClick:t[1]||(t[1]=e=>m(Te)("Sidebars"))}," ≡"),c("div",{onPointerenter:t[2]||(t[2]=e=>m(Ve)()),onPointerleave:t[3]||(t[3]=e=>m(Ae)()),class:"helpicon"}," ? ",32)]),c("div",$t,[(l(),_(F,null,[(l(),_(C(m(Ce)())))],1024))])])),_:1},8,["collapsed"])])),bottom:M((()=>[w(kt)])),_:1},8,["collapsed"])]))}}),Ht=i({setup:e=>(e,t)=>(l(),_(Yt))});window.global={},A(Ht).mount("#app");
